# GUI приложение для генерации изображений с помощью обученных моделей Diffusion-GAN

Графический интерфейс для генерации изображений с использованием обученных моделей Diffusion GAN. Приложение предоставляет удобный способ генерации изображений без необходимости использования командной строки.

## Содержание

- [Требования](#требования)
- [Установка](#установка)
- [Запуск](#запуск)
- [Описание интерфейса](#описание-интерфейса)
- [Параметры генерации](#параметры-генерации)
- [Структура проекта](#структура-проекта)

## Требования

### Системные требования

- Python 3.7 или выше
- PySide6 (Qt для Python)
- PyTorch
- CUDA (опционально, для использования GPU)
- X11 сервер (для работы через SSH)

### Зависимости Python

Основные зависимости:
- `PySide6` - графический интерфейс
- `torch` - глубокое обучение
- `numpy` - численные вычисления
- `PIL` (Pillow) - работа с изображениями

## Установка

### 1. Установка системных зависимостей (Linux)

Для работы GUI через X11 forwarding необходимо установить библиотеки X11:

```bash
sudo apt-get update
sudo apt-get install -y libxcb-cursor0 libxcb-xinerama0 libxcb-xfixes0 \
    libxkbcommon-x11-0 libxrender1 libfontconfig1 libxext6 libx11-6 \
    x11-utils libgl1-mesa-glx libglib2.0-0
```

### 2. Установка Python зависимостей

Если используется conda окружение:

```bash
conda activate pg  # или ваше имя окружения
conda install -c conda-forge pyside6
```

Или через pip:

```bash
pip install PySide6
```

### 3. Настройка X11 forwarding (для работы через SSH)

**На Windows:**
- Установите Xming или VcXsrv
- Запустите X сервер перед подключением по SSH
- Подключитесь с флагом `-X`: `ssh -X username@hostname`

**На Linux/Mac:**
- Обычно X сервер уже установлен
- Подключитесь с флагом `-X`: `ssh -X username@hostname`

## Запуск

### Способ 1: Через модуль Python (рекомендуется)

```bash
cd /path/to/diffusion-projected-gan
python -m gen_images_gui.app
```

### Способ 2: Напрямую через app.py

```bash
cd /path/to/diffusion-projected-gan
python gen_images_gui/app.py
```

### Способ 3: Импорт в Python скрипте

```python
from gen_images_gui import main
main()
```

## Описание интерфейса

Приложение состоит из четырех основных частей:

### 1. Поля ввода параметров (верхняя часть)

Содержит все параметры для генерации изображений:
- **Network (--network)** - путь к файлу модели или URL
- **Seeds (--seeds)** - список seed'ов для генерации
- **Truncation Psi (--trunc)** - параметр усечения (по умолчанию: 1)
- **Class (--class)** - метка класса (опционально)
- **Noise Mode (--noise-mode)** - режим шума (const/random/none)
- **Translate (--translate)** - координаты переноса (по умолчанию: 0,0)
- **Rotate (--rotate)** - угол поворота в градусах (по умолчанию: 0)
- **Output Directory (--outdir)** - директория для сохранения изображений

### 2. Окно предпросмотра (середина)

Отображает сгенерированные изображения. После завершения генерации всех изображений автоматически показывается первое изображение.

### 3. Навигация по изображениям

Кнопки для переключения между сгенерированными изображениями:
- **◀ Предыдущее** - показать предыдущее изображение
- **Следующее ▶** - показать следующее изображение
- Счетчик показывает текущее изображение и общее количество

### 4. Окно логирования (нижняя часть)

Отображает информацию о процессе генерации:
- Загрузка модели
- Прогресс генерации каждого изображения
- Сообщения об ошибках
- Статистика загруженных изображений

## Параметры генерации

### Network (--network)

**Обязательный параметр**

Путь к файлу предобученной модели (`.pkl`) или URL для загрузки модели.

**Примеры:**
- Локальный файл: `/path/to/model.pkl`
- URL: `https://api.ngc.nvidia.com/v2/models/nvidia/research/stylegan3/versions/1/files/stylegan3-r-afhqv2-512x512.pkl`

### Seeds (--seeds)

**Обязательный параметр**

Список случайных seed'ов для генерации. Можно указать отдельные числа или диапазоны.

**Формат:**
- Отдельные числа: `0,1,5`
- Диапазоны: `0-10` (генерирует числа от 0 до 10 включительно)
- Комбинация: `0,1,5-10,20` (генерирует: 0, 1, 5, 6, 7, 8, 9, 10, 20)

**Примеры:**
- `0` - одно изображение
- `0,1,2` - три изображения
- `0-9` - десять изображений (0, 1, 2, ..., 9)
- `1000-1999` - тысяча изображений

### Truncation Psi (--trunc)

**По умолчанию: 1**

Параметр усечения, контролирующий разнообразие генерируемых изображений:
- `1.0` - максимальное разнообразие
- `0.7` - более консервативная генерация
- Меньшие значения дают более предсказуемые результаты

### Class (--class)

**Опциональный параметр**

Метка класса для условных моделей. Требуется только для условных сетей.

**Пример:** `0`, `1`, `2` и т.д.

### Noise Mode (--noise-mode)

**По умолчанию: const**

Режим генерации шума:
- `const` - постоянный шум
- `random` - случайный шум
- `none` - без шума

### Translate (--translate)

**По умолчанию: 0,0**

Координаты переноса изображения в формате `x,y`.

**Примеры:**
- `0,0` - без переноса
- `0.3,1` - перенос по X на 0.3, по Y на 1

### Rotate (--rotate)

**По умолчанию: 0**

Угол поворота изображения в градусах.

**Примеры:**
- `0` - без поворота
- `90` - поворот на 90 градусов
- `-45` - поворот на -45 градусов

### Output Directory (--outdir)

**По умолчанию: out**

Директория для сохранения сгенерированных изображений. Если директория не существует, она будет создана автоматически.

## Структура проекта

```
gen_images_gui/
├── __init__.py              # Экспорт основных классов
├── app.py                   # Точка входа приложения
├── main_window.py           # Главное окно GUI
├── utils.py                 # Утилиты для парсинга параметров
├── threads/
│   ├── __init__.py
│   └── generation_worker.py # Рабочий поток генерации
└── README.md                # Документация
```

### Основные компоненты

- **`app.py`** - точка входа, запускает GUI приложение
- **`main_window.py`** - реализация главного окна и всей логики интерфейса
- **`utils.py`** - вспомогательные функции для парсинга параметров
- **`threads/generation_worker.py`** - класс для генерации изображений в отдельном потоке